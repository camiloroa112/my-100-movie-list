<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/styles.css">
    <title>Movies & More</title>
</head>
<body id="movie_menu" class="d-flex flex-column h-100">
    <div class="container">
        <header
            class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom">
            <a href="movie_menu.html"
                class="d-flex align-items-center col-md-3 mb-2 mb-md-0 text-dark text-decoration-none img-fluid gap-3">
                <img src="/img/film-solid.svg" alt="" class="img-fluid gap-3 mr-2" style="width: 15px;">C & Co. Films
            </a>
            <div class="col-12 col-md-auto mb-2 justify-content-center mb-md-0">
                <img src="/img/clapperboard-solid.svg" alt="" class="img-fluid gap-2 mr-2 d-inline my-auto"
                    style="width: 20px;">
                <h4 class="text-center d-inline my-auto" style="font-size: 20px;">My 100 Movie List</h4>
            </div>
            <div class="text-end">
                <a href="/logout"><button type="button" class="btn bg-primary me-2 text-white">Sign
                        Out</button></a>
            </div>
        </header>
    </div>
    <main id="carrousel-images">
        <div class="container">
            <div class="row justify-content-center">
                <div class="carousel slide" data-bs-ride="carousel" id="catalogue">
                    <ol class="carousel-indicators">
                        <li data-bs-target="#catalogue" data-bs-slide-to="0" class="active"></li>
                        <li data-bs-target="#catalogue" data-bs-slide-to="1"></li>
                        <li data-bs-target="#catalogue" data-bs-slide-to="2"></li>
                    </ol>
                    <div class="carousel-inner rounded">
                        <div class="carousel-item active">
                            <img class="d-block w-100" src="/img/alfie2005.jpg" alt="First slide">
                            <div class="carousel-caption d-none d-md-block">
                                <h5>Alfie 2005</h5>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <img class="d-block w-100" src="/img/avengers.jpg" alt="Second slide">
                            <div class="carousel-caption d-none d-md-block">
                                <h5>Avengers - Endgame</h5>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <img class="d-block w-100" src="/img/batman.jpg" alt="Third slide">
                            <div class="carousel-caption d-none d-md-block">
                                <h5>Batman - The Dark Knight Rises</h5>
                            </div>
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#catalogue" role="button" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#catalogue" role="button" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
            <h1 class="text-center mt-3" style="font-size: 30px;">Uploading Movie</h1>
            <hr />
            <div>
                <form action="/movie" enctype="multipart/form-data" id="movie-form">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" class="form-control" id="name" name="name" placeholder="Movie name" required>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" class="form-control" id="date" name="date" placeholder="date" required>
                    </div>
                    <div class="form-group">
                        <label>User</label>
                        <input type="text" class="form-control" id="user" name="user" placeholder="Username" required>
                    </div>
                    <div class="form-group ratings-wrapper" id="rating" name="rating">
                        <label>Rating</label>
                        <div productid="39" class="ratings">
                            <span data-rating="5">&#9733;</span>
                            <span data-rating="4">&#9733;</span>
                            <span data-rating="3">&#9733;</span>
                            <span data-rating="2">&#9733;</span>
                            <span data-rating="1">&#9733;</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Movie Attachment</label>
                        <input type="file" class="form-control" id="img" name="img">
                    </div>
                    <button type="submit" class="btn btn-primary my-3 d-block">Submit</button>
                </form>
            </div>
            <div>
                <table class="table" id="movie-list" name="movie-list">
                    <thead>
                        <tr>
                            <th scope="col">ID</th>
                            <th scope="col">Name</th>
                            <th scope="col">Creation Date</th>
                            <th scope="col">User</th>
                            <th scope="col">Rating</th>
                            <th scope="col">Image</th>
                            <th scope="col">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        
                    </tbody>
                </table>
            </div>
        </div>
    </main>
    <script>
        $(document).ready(function () 
        {
            $('#catalogue').carousel();
        });
    </script>
    <script>
        let form = document.getElementById('movie-form');
        form.addEventListener('submit', function(event) 
        {
            event.preventDefault(); 
            addEntries(event);
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="script.js"></script>
    <script>
        function getStarRating(rating) 
        {
            let stars = '';
            for (let i = 1; i <= 5; i++) 
            {
                if (i <= rating) 
                {
                    stars += '<span style="color: #fdd835;">&#9733;</span>';
                } 
                
                else 
                {
                    stars += '<span style="color: #bdbdbd;">&#9733;</span>';
                }
            }
            return stars;
        }

        // Function to add entries to the table
        function addEntries(event) 
        {
            // Get the selected rating
            var selectedRating = getRating();
    
            // Retrieve other form data
            var name = document.getElementById('name').value;
            var date = document.getElementById('date').value;
            var user = document.getElementById('user').value;
    
            // Log the selected rating for testing purposes
            console.log("Selected Rating: " + selectedRating);
    
            // Getting the Table whose ID is movie-list
            let table = document.getElementById('movie-list');
    
            // Retrieving row count
            let lastRow = table.rows.length;
    
            // Inserting new row
            let row = table.insertRow(lastRow);
            row.classList.add('table-info');
    
            // Introducing value in a cell
            let cell = row.insertCell(0);
            let cell1 = row.insertCell(1);
            let cell2 = row.insertCell(2);
            let cell3 = row.insertCell(3);
            let cell4 = row.insertCell(4);
            let cell5 = row.insertCell(5);
            let cell6 = row.insertCell(6);
    
            // Introducing value in new cell being what has been placed on input with a button
            cell.innerHTML = lastRow;
            cell.classList.add('align-middle');
            cell1.innerHTML = name;
            cell1.classList.add('align-middle');
            cell2.innerHTML = date;
            cell2.classList.add('align-middle');
            cell3.innerHTML = user;
            cell3.classList.add('align-middle');
            cell4.innerHTML = getStarRating(selectedRating); 
            cell4.classList.add('align-middle');
            cell5.innerHTML = "";
            cell6.innerHTML = '<button class="btn bg-primary text-white btn-delete">' + '<i class="fa-solid fa-trash-can"></i>' + '</button>';
            cell6.classList.add('align-middle');
    
            // Obtain the image file
            let imgInput = document.getElementById('img');
            let imgFile = imgInput.files[0];
            // Get the file name if available
            let imgName = imgFile ? imgFile.name : "";
    
            // Display image in the table if available
            cell5.innerHTML = imgName ? `<img src="${URL.createObjectURL(imgFile)}" alt="${imgName}" style="max-width: 100px;">` : "";
            cell5.classList.add('align-middle');

            // Sending the data to the server using fetch
            fetch('/movie', 
            {
                method: 'POST',
                body: formData
            })
            .then(response => 
            {
                if (response.ok) 
                {
                    console.log('Movie saved successfully');
                    
                } 
                else 
                {
                    // Error handling here
                    console.error('Failed to save movie');
                }
            })

            .catch(error => 
            {
                console.error('Error saving movie:', error);
                // Handle errors here
            });
    
            // Element for deleting a specific row
            row.querySelector('.btn-delete').addEventListener('click', deleteRow);
        }
    
        // Function to delete a specific row
        function deleteRow(event) 
        {
            let row = event.target.closest('tr');
            row.remove();
        }
    
        // Function to get the rating value
        function getRating() 
        {
            let stars = document.querySelectorAll('.ratings span');
            let rating = 0;

            for (let star of stars) 
            {
                if (star.getAttribute('data-clicked')) {
                    rating = star.dataset.rating;
                    break;
                }
            }
            return rating;
        }
    </script>    
</body>
<footer class="container d-flex flex-wrap justify-content-between align-items-center mt-auto border-top">
    <div class="col-sm-4 col-md-4 col-lg-4 col-xl-4 d-flex pt-4">
        <p class="name">© C & Co. Films</p>
    </div>
</footer>
</html>